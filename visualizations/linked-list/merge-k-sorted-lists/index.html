<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge K Sorted Lists - Divide & Conquer</title>
    <link rel="stylesheet" href="../../shared/css/main.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="../../" class="back-link">&larr; Back to all algorithms</a>
        <h1>Merge K Sorted Lists</h1>
        <p class="description">Merge k sorted linked lists using divide and conquer with O(n log k) time complexity</p>

        <div class="controls">
            <div class="input-group textarea-group">
                <label>K Sorted Lists (one per line):</label>
                <textarea id="listsInput" rows="4" placeholder="1, 4, 5&#10;1, 3, 4&#10;2, 6">1, 4, 5
1, 3, 4
2, 6</textarea>
            </div>
            <button class="btn-random" id="randomBtn">Random</button>
            <button class="btn-primary" id="resetBtn">Reset</button>
            <button class="btn-secondary" id="stepBtn">Step</button>
            <button class="btn-success" id="playBtn">Play</button>
            <div class="speed-control">
                <label>Speed:</label>
                <input type="range" id="speedSlider" min="100" max="2000" value="800">
            </div>
        </div>

        <div class="main-content">
        <div class="visualization">
            <div class="section-title">K Linked Lists</div>

            <div class="lists-wrapper" id="listsWrapper">
                <div class="lists-container" id="listsDisplay"></div>
            </div>

            <div class="info-panel">
                <div class="info-box phase-box">
                    <h3>Phase</h3>
                    <div class="info-value" id="phaseValue">-</div>
                    <div class="pointer-desc">Current operation</div>
                </div>
                <div class="info-box pair-box">
                    <h3>Active Pair</h3>
                    <div class="info-value" id="pairValue">-</div>
                    <div class="pointer-desc">Lists being merged</div>
                </div>
                <div class="info-box depth-box">
                    <h3>Depth</h3>
                    <div class="info-value" id="depthValue">0</div>
                    <div class="pointer-desc">Recursion level</div>
                </div>
                <div class="info-box k-box">
                    <h3>K</h3>
                    <div class="info-value" id="kValue">0</div>
                    <div class="pointer-desc">Number of lists</div>
                </div>
            </div>

            <div class="merge-info" id="mergeInfo" style="display: none;">
                <div class="merge-title">Merging Two Lists</div>
                <div class="merge-pointers">
                    <div class="merge-ptr left-merge-ptr">
                        <span class="ptr-label">Left:</span>
                        <span class="ptr-value" id="leftPtrValue">-</span>
                    </div>
                    <div class="merge-ptr right-merge-ptr">
                        <span class="ptr-label">Right:</span>
                        <span class="ptr-value" id="rightPtrValue">-</span>
                    </div>
                </div>
            </div>

            <div class="status" id="status">
                Click "Step" or "Play" to start merging the k sorted lists
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color default-color"></div>
                    <span>Inactive</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color active-color"></div>
                    <span>Active</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color comparing-color"></div>
                    <span>Comparing</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color merged-color"></div>
                    <span>Merged</span>
                </div>
            </div>

        </div>

        <div class="code-panel">
            <div class="section-title">Python Code - Merge K Sorted Lists</div>
            <div class="code-line" id="code-0">
                <span class="code-keyword">def</span> <span class="code-function">mergeKLists</span>(lists):
            </div>
            <div class="code-line" id="code-1">
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if not</span> lists:
            </div>
            <div class="code-line" id="code-2">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">None</span>
            </div>
            <div class="code-line" id="code-3">
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> len(lists) == <span class="code-number">1</span>:
            </div>
            <div class="code-line" id="code-4">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> lists[<span class="code-number">0</span>]
            </div>
            <div class="code-line" id="code-5">
                &nbsp;&nbsp;&nbsp;&nbsp;mid = len(lists) // <span class="code-number">2</span>
            </div>
            <div class="code-line" id="code-6">
                &nbsp;&nbsp;&nbsp;&nbsp;left = mergeKLists(lists[:mid])
            </div>
            <div class="code-line" id="code-7">
                &nbsp;&nbsp;&nbsp;&nbsp;right = mergeKLists(lists[mid:])
            </div>
            <div class="code-line" id="code-8">
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> _merge(left, right)
            </div>
            <div class="code-line" id="code-9">
                &nbsp;
            </div>
            <div class="code-line" id="code-10">
                <span class="code-keyword">def</span> <span class="code-function">_merge</span>(first, second):
            </div>
            <div class="code-line" id="code-11">
                &nbsp;&nbsp;&nbsp;&nbsp;dummy = ListNode()
            </div>
            <div class="code-line" id="code-12">
                &nbsp;&nbsp;&nbsp;&nbsp;tail = dummy
            </div>
            <div class="code-line" id="code-13">
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">while</span> first <span class="code-keyword">and</span> second:
            </div>
            <div class="code-line" id="code-14">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> first.val &lt; second.val:
            </div>
            <div class="code-line" id="code-15">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tail.next = first; first = first.next
            </div>
            <div class="code-line" id="code-16">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">else</span>:
            </div>
            <div class="code-line" id="code-17">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tail.next = second; second = second.next
            </div>
            <div class="code-line" id="code-18">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tail = tail.next
            </div>
            <div class="code-line" id="code-19">
                &nbsp;&nbsp;&nbsp;&nbsp;tail.next = first <span class="code-keyword">or</span> second
            </div>
            <div class="code-line" id="code-20">
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> dummy.next
            </div>
        </div>
        </div>

        <div class="complexity-section">
            <input type="checkbox" id="complexity-toggle" class="complexity-toggle-input" checked>
            <label for="complexity-toggle" class="complexity-header">
                <span class="complexity-title">Complexity Analysis</span>
                <span class="complexity-icon"></span>
            </label>
            <div class="complexity-content">
                <input type="radio" id="tab-time" name="complexity-tab" class="complexity-tab-input" checked>
                <input type="radio" id="tab-space" name="complexity-tab" class="complexity-tab-input">
                <div class="complexity-columns">
                    <div class="complexity-stats">
                        <label for="tab-time" class="complexity-item">
                            <span class="complexity-label">Time Complexity</span>
                            <span class="complexity-value">O(n log k)</span>
                        </label>
                        <label for="tab-space" class="complexity-item">
                            <span class="complexity-label">Space Complexity</span>
                            <span class="complexity-value">O(log k)</span>
                        </label>
                    </div>
                    <div class="complexity-explanation">
                        <div class="complexity-detail time-detail">
                            <h4 class="detail-title">Time Complexity: <span class="big-o">O(n log k)</span></h4>
                            <div class="detail-section">
                                <div class="detail-section-title">Breakdown</div>
                                <div class="detail-content">
                                    <ul class="detail-list">
                                        <li>Merge levels: ⌈log k⌉ (k lists → 1 list)</li>
                                        <li>Work per level: O(n) total nodes merged</li>
                                        <li>Each node touched once per level</li>
                                        <li>Total: O(log k) levels × O(n) = O(n log k)</li>
                                    </ul>
                                    <div class="detail-formula">T(n,k) = O(log k) levels × O(n) merge work = O(n log k)</div>
                                </div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Mathematical Intuition</div>
                                <div class="detail-content">
                                    <p>Divide-and-conquer pairs up lists and merges: k lists → k/2 lists → k/4 lists → ... → 1 list. With ⌈log k⌉ merge rounds, and n total nodes processed per round, we get O(n log k). The naive approach (merge one at a time) costs O(n × k) because early lists are re-scanned.</p>
                                </div>
                            </div>
                            <div class="detail-insight">
                                <span class="detail-insight-label">Key Insight</span>
                                <p>Alternative: min-heap of k list heads yields O(n log k) by extracting minimum in O(log k) for each of n nodes. Same complexity, different constant factors.</p>
                            </div>
                        </div>
                        <div class="complexity-detail space-detail">
                            <h4 class="detail-title">Space Complexity: <span class="big-o">O(log k)</span></h4>
                            <div class="detail-section">
                                <div class="detail-section-title">Breakdown</div>
                                <div class="detail-content">
                                    <ul class="detail-list">
                                        <li>Recursion stack depth: O(log k)</li>
                                        <li>Each frame: O(1) pointers</li>
                                        <li>Merging: O(1) by pointer manipulation</li>
                                        <li>No auxiliary arrays needed</li>
                                    </ul>
                                    <div class="detail-formula">S(k) = O(log k) — recursion stack only</div>
                                </div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Mathematical Intuition</div>
                                <div class="detail-content">
                                    <p>The divide-and-conquer splits the list array in half recursively, giving O(log k) depth. Each merge operation uses constant extra space (dummy head, tail pointer). The heap approach uses O(k) space for the heap, which may be better or worse depending on k vs. log k.</p>
                                </div>
                            </div>
                            <div class="detail-insight">
                                <span class="detail-insight-label">Key Insight</span>
                                <p>Iterative pairwise merging (bottom-up) eliminates recursion entirely, achieving O(1) auxiliary space with O(k) pointers to track current lists.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../shared/js/visualizer.js"></script>
    <script src="script.js"></script>
</body>
</html>
